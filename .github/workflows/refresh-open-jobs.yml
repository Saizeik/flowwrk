name: Refresh Open Jobs Feed

on:
  schedule:
    - cron: "0 0 * * *" # daily at 00:00 UTC
  workflow_dispatch: {}

jobs:
  refresh:
    runs-on: ubuntu-latest

    # If your secrets are stored under Settings -> Environments -> production,
    # uncomment the next line and ensure the name matches exactly.
    # environment: production

    steps:
      - name: Diagnostics (safe)
        run: |
          echo "repo:  $GITHUB_REPOSITORY"
          echo "ref:   $GITHUB_REF"
          echo "sha:   $GITHUB_SHA"
          echo "event: $GITHUB_EVENT_NAME"
          echo "actor: $GITHUB_ACTOR"

      - name: Secrets visibility (safe booleans)
        env:
          HAS_FUNCTION_URL: ${{ secrets.SUPABASE_FUNCTION_URL != '' }}
          HAS_SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY != '' }}
          HAS_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY != '' }}
        run: |
          echo "HAS_FUNCTION_URL=$HAS_FUNCTION_URL"
          echo "HAS_SERVICE_ROLE=$HAS_SERVICE_ROLE"
          echo "HAS_ANON_KEY=$HAS_ANON_KEY"

      - name: Call Supabase Edge Function
        env:
          FUNCTION_URL: ${{ secrets.SUPABASE_FUNCTION_URL }}
          SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROL_
